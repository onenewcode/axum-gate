# Configuration file for git-cliff
# Learn more: https://git-cliff.org/docs/configuration

[changelog]
# Header template for the changelog
header = """
# ğŸ“œ Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

"""

# Body template for each version
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}\
    {% set group_name = group | replace(from="ğŸ›³  ", to="") | replace(from="ğŸ ", to="") | replace(from="ğŸ“„ ", to="") | replace(from="ğŸ  ", to="") | replace(from="ğŸ—  ", to="") | replace(from="âš’ ", to="") | replace(from="ğŸš² ", to="") %}\
    ### {{ group }}
    {% for commit in commits %}\
        {% if commit.breaking %}\
    - **ğŸ’¥ BREAKING CHANGE:** {{ commit.message | upper_first }}{% if commit.scope %} *({{ commit.scope }})* {% endif %} [[{{ commit.id | truncate(length=7, end="") }}]]

        {% else %}\
    - {{ commit.message | upper_first }}{% if commit.scope %} *({{ commit.scope }})* {% endif %} [[{{ commit.id | truncate(length=7, end="") }}]]

        {% endif %}\
    {% endfor %}

{% endfor %}\
"""

# Footer template
footer = """
---

<!-- generated by git-cliff -->
"""

# Remove excess newlines and whitespace
trim = true

[git]
# Parse conventional commits
conventional_commits = true
# Include non-conventional commits too
filter_unconventional = false
# Split commits by line
split_commits = false

# Define how commits are parsed and categorized
commit_parsers = [
    # Features
    { message = "^feat", group = "ğŸ›³ Features"},
    { message = "^feature", group = "ğŸ›³ Features"},

    # Bug fixes
    { message = "^fix", group = "ğŸ Bug Fixes"},
    { message = "^bug", group = "ğŸ Bug Fixes"},
    { message = "^hotfix", group = "ğŸ Bug Fixes"},

    # Performance improvements
    { message = "^perf", group = "ğŸ Performance"},
    { message = "^performance", group = "ğŸ Performance"},

    # Refactoring
    { message = "^refactor", group = "ğŸ— Refactoring"},
    { message = "^refact", group = "ğŸ— Refactoring"},

    # Documentation
    { message = "^docs", group = "ğŸ“„ Documentation"},
    { message = "^doc", group = "ğŸ“„ Documentation"},

    # Tests
    { message = "^test", group = "âš’ Testing"},
    { message = "^tests", group = "âš’ Testing"},

    # Build system and dependencies
    { message = "^build", group = "ğŸ”§ Build System"},
    { message = "^deps", group = "ğŸ“¦ Dependencies"},
    { message = "^dep", group = "ğŸ“¦ Dependencies"},

    # CI/CD
    { message = "^ci", group = "ğŸ‘· CI/CD"},

    # Style changes (formatting, missing semicolons, etc.)
    { message = "^style", group = "ğŸ¨ Style"},
    { message = "^fmt", group = "ğŸ¨ Style"},
    { message = "^format", group = "ğŸ¨ Style"},

    # Miscellaneous tasks
    { message = "^chore", group = "ğŸš² Miscellaneous"},
    { message = "^misc", group = "ğŸš² Miscellaneous"},

    # Security fixes
    { message = "^security", group = "ğŸ”’ Security"},
    { message = "^sec", group = "ğŸ”’ Security"},

    # Reverts
    { message = "^revert", group = "âª Reverts"},

    # Catch-all for any other commits
    { message = ".*", group = "ğŸ“ Other Changes"},

    # Skip certain commits
    { message = "^wip", skip = true},
    { message = "^work in progress", skip = true},
    { message = "^tmp", skip = true},
    { message = "^temp", skip = true},
]

# Protect breaking changes from being skipped
protect_breaking_commits = true

# Filter commits based on patterns
filter_commits = false

# Ignore certain tags
ignore_tags = "beta|alpha|rc"

# Sort commits topologically
topo_order = false

# Sort commits chronologically
sort_commits = "newest"

# Link parsers for issue/PR references
link_parsers = [
    # GitHub issues
    { pattern = "#(\\d+)", href = "https://github.com/emirror-de/axum-gate/issues/$1", text = "#$1"},
    # GitHub pull requests
    { pattern = "PR#(\\d+)", href = "https://github.com/emirror-de/axum-gate/pull/$1", text = "PR#$1"},
    # Direct commit references
    { pattern = "\\b([0-9a-f]{7,40})\\b", href = "https://github.com/emirror-de/axum-gate/commit/$1", text = "$1"},
]

# Additional commit preprocessing
commit_preprocessors = [
    # Remove conventional commit prefixes from the final message
    { pattern = '^\w+(\(.+\))?\s*:\s*(.*)$', replace = "$2"},
    # Clean up common patterns
    { pattern = '\s+', replace = " "},
]

# Tags configuration
git.tag_pattern = "v[0-9].*"

# Bump configuration for semantic versioning
[bump]
# Features bump minor version
features_always_bump_minor = true
# Breaking changes bump major version
breaking_always_bump_major = true
